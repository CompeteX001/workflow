<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NCERT Class 10 Science AI Chatbot</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: #e0e0e0;
            font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .container {
            max-width: 800px;
            margin: 30px auto 0 auto;
            background: #1e1e1e;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
            padding: 24px 20px 80px 20px;
            border: 1px solid #2a2a2a;
        }
        h1 {
            color: #f5f5f5;
            font-size: 2em;
            text-align: center;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        #chat-window {
            background: #171717;
            border-radius: 12px;
            min-height: 400px;
            max-height: 60vh;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 18px 14px;
            margin-bottom: 20px;
            word-break: break-word;
            font-size: 0.98em;
            line-height: 1.7;
            border: 1px solid #2a2a2a;
        }
        #chat-window::-webkit-scrollbar {
            width: 8px;
        }
        #chat-window::-webkit-scrollbar-track {
            background: #1e1e1e;
            border-radius: 4px;
        }
        #chat-window::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }
        #chat-window::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
        .user-msg {
            color: #f5f5f5;
            font-weight: 600;
            margin-bottom: 0.8em;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
            border-left: 3px solid #667eea;
            border-radius: 8px;
        }
        .bot-msg {
            color: #d0d0d0;
            display: block;
            font-weight: 400;
            margin-bottom: 1.2em;
            font-size: 1em;
            border-left: 3px solid #10b981;
            padding: 12px 16px;
            background: rgba(16, 185, 129, 0.05);
            border-radius: 8px;
            letter-spacing: 0.2px;
        }
        .bot-msg b {
            color: #10b981;
            font-weight: 600;
        }
        .bot-msg ul, .bot-msg ol {
            margin: 10px 0;
            padding-left: 24px;
        }
        .bot-msg li {
            margin: 8px 0;
            line-height: 1.6;
        }
        .glow-text {
            color: #10b981;
            font-weight: 600;
        }
        #entry-bar {
            width: 100%;
            display: flex;
            gap: 0.8em;
            position: fixed;
            left: 0;
            bottom: 0;
            background: #1e1e1e;
            padding: 16px 14px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
            border-top: 1px solid #2a2a2a;
            z-index: 100;
        }
        #user-input {
            flex: 1;
            border-radius: 8px;
            background: #171717;
            color: #e0e0e0;
            font-size: 1em;
            padding: 14px 16px;
            border: 1px solid #2a2a2a;
            outline: none;
            font-family: inherit;
            transition: all 0.2s;
        }
        #user-input:focus {
            border: 1px solid #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        #user-input::placeholder {
            color: #6b7280;
        }
        #send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            font-size: 1.05em;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            letter-spacing: 0.5px;
            padding: 14px 28px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        #send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        #send-btn:active {
            transform: translateY(0);
        }
        @media (max-width: 600px) {
            .container{max-width:95vw;padding:16px 3vw 90px 3vw;margin-top:15px;}
            h1{font-size:1.6em;}
            #chat-window{font-size:0.92em;max-height:65vh;padding:14px 10px;}
            #entry-bar{padding:12px 3vw;}
            #user-input{font-size:0.95em;padding:12px 14px;}
            #send-btn{font-size:0.95em;padding:12px 20px;}
        }
        ::selection {
            background: rgba(102, 126, 234, 0.3);
            color: #fff;
        }
        .bot-msg.typing {
            border-left: 3px solid #10b981;
            color: #a0a0a0;
        }
        .score-display {
            background: rgba(102, 126, 234, 0.1);
            padding: 14px;
            border-radius: 8px;
            margin: 12px 0;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        .mcq-option {
            padding: 10px 14px;
            margin: 8px 0;
            background: rgba(16, 185, 129, 0.05);
            border-left: 3px solid #10b981;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .mcq-option:hover {
            background: rgba(16, 185, 129, 0.12);
            transform: translateX(4px);
            border-left-width: 4px;
        }
        .info-box {
            background: rgba(102, 126, 234, 0.08);
            padding: 14px;
            border-radius: 8px;
            margin: 12px 0;
            border-left: 3px solid #667eea;
        }
        .success-box {
            background: rgba(16, 185, 129, 0.08);
            padding: 14px;
            border-radius: 8px;
            margin: 12px 0;
            border-left: 3px solid #10b981;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>NCERT Class 10 Science AI</h1>
        <div id="chat-window"></div>
    </div>
    <form id="entry-bar" autocomplete="off" onsubmit="return false;">
        <input id="user-input" type="text" autocomplete="off" placeholder="Type your science question..." autofocus>
        <button id="send-btn" type="submit">ASK</button>
    </form>
    <script>
        // -- Data Section --
        const data = {
    "Chapter 1: Chemical Reactions and Equations": {
        definitions: {
            "chemical reaction": "A process in which one or more substances (reactants) are converted into one or more different substances (products).",
            "chemical equation": "A symbolic representation of a chemical reaction showing reactants and products.",
            "balanced chemical equation": "An equation in which the number of atoms of each element is equal on both sides, obeying the law of conservation of mass.",
            "oxidation": "Loss of electrons; gain of oxygen or loss of hydrogen.",
            "reduction": "Gain of electrons; loss of oxygen or gain of hydrogen.",
            "corrosion": "Gradual destruction of metals by chemical reaction with environment, e.g., rusting.",
            "rancidity": "Spoilage of food containing fats/oils due to oxidation, causing bad taste and smell.",
            "combination reaction": "Two or more reactants combine to form one product: A + B ‚Üí AB.",
            "decomposition reaction": "A single compound breaks down into two or more simpler substances: AB ‚Üí A + B.",
            "displacement reaction": "A more reactive element displaces a less reactive one from its compound: A + BC ‚Üí AC + B.",
            "double displacement reaction": "Exchange of ions between two compounds: AB + CD ‚Üí AD + CB.",
            "redox reaction": "A reaction in which both oxidation and reduction occurs simultaneously."
        },
        formulas: [],
        equations: [
            "A + B ‚Üí AB (Combination)",
            "AB ‚Üí A + B (Decomposition)",
            "A + BC ‚Üí AC + B (Displacement)",
            "AB + CD ‚Üí AD + CB (Double Displacement)",
            "Fe + O‚ÇÇ + H‚ÇÇO ‚Üí Fe‚ÇÇO‚ÇÉ¬∑xH‚ÇÇO (Rusting)"
        ],
        typesOfReaction: [
            {type: "Combination", def: "Two or more reactants combine to form one product: A + B ‚Üí AB."},
            {type: "Decomposition", def: "A single compound breaks down into two or more simpler substances: AB ‚Üí A + B (Thermal/Electrolytic/Photo)."},
            {type: "Displacement", def: "A more reactive element displaces a less reactive one from its compound: A + BC ‚Üí AC + B."},
            {type: "Double Displacement", def: "Exchange of ions between two compounds: AB + CD ‚Üí AD + CB."},
            {type: "Redox", def: "A reaction in which both oxidation and reduction occurs simultaneously."}
        ],
        examples: [
            "Heating calcium carbonate: CaCO‚ÇÉ ‚Üí CaO + CO‚ÇÇ (Decomposition)",
            "Iron rusting: Fe + O‚ÇÇ + H‚ÇÇO ‚Üí Fe‚ÇÇO‚ÇÉ¬∑xH‚ÇÇO (Combination/Redox)",
            "Zinc with copper sulphate: Zn + CuSO‚ÇÑ ‚Üí ZnSO‚ÇÑ + Cu (Displacement)"
        ],
        points: [
            "Chemical changes involve change in state, colour, temperature, or evolution of gas.",
            "Chemical equations must be balanced to obey the law of conservation of mass.",
            "Redox reactions involve simultaneous oxidation and reduction."
        ]
    },
    "Chapter 2: Acids, Bases and Salts": {
        definitions: {
            "acid": "A substance that releases H‚Å∫ ions in aqueous solution.",
            "base": "A substance that releases OH‚Åª ions in aqueous solution.",
            "indicator": "A substance that indicates acidity/basicity by change in colour.",
            "pH": "A measure of hydrogen ion concentration. Lower pH = more acidic. Formula: pH = ‚Äìlog[H‚Å∫].",
            "neutralization": "Reaction between acid and base to give salt and water: NaOH + HCl ‚Üí NaCl + H‚ÇÇO.",
            "salt": "Product of reaction of an acid and a base.",
            "rancidity": "Spoilage of food containing fats/oils due to oxidation.",
            "common salt": "Sodium chloride; NaCl.",
            "baking soda": "Sodium bicarbonate; NaHCO‚ÇÉ.",
            "washing soda": "Sodium carbonate; Na‚ÇÇCO‚ÇÉ¬∑10H‚ÇÇO.",
            "bleaching powder": "Calcium oxychloride; CaOCl‚ÇÇ.",
            "plaster of Paris": "CaSO‚ÇÑ¬∑¬ΩH‚ÇÇO; a hemihydrate of calcium sulfate."
        },
        formulas: [
            "pH = ‚Äìlog[H‚Å∫]"
        ],
        equations: [
            "NaOH + HCl ‚Üí NaCl + H‚ÇÇO (Neutralization)",
            "Zn + H‚ÇÇSO‚ÇÑ ‚Üí ZnSO‚ÇÑ + H‚ÇÇ‚Üë",
            "CaCO‚ÇÉ + 2HCl ‚Üí CaCl‚ÇÇ + H‚ÇÇO + CO‚ÇÇ",
            "NaCl + H‚ÇÇO + CO‚ÇÇ + NH‚ÇÉ ‚Üí NaHCO‚ÇÉ + NH‚ÇÑCl (Baking Soda Preparation)",
            "Ca(OH)‚ÇÇ + Cl‚ÇÇ ‚Üí CaOCl‚ÇÇ + H‚ÇÇO (Bleaching Powder)",
            "2CaSO‚ÇÑ¬∑2H‚ÇÇO ‚Üí 2CaSO‚ÇÑ¬∑¬ΩH‚ÇÇO + 3H‚ÇÇO (Plaster of Paris)"
        ],
        examples: [
            "Litmus colour change in acids and bases.",
            "NaOH + HCl gives table salt and water.",
            "Baking soda is used as antacid."
        ],
        points: [
            "Acids turn blue litmus red; bases turn red litmus blue.",
            "The neutralization of acids and bases forms salt and water.",
            "pH of body fluids is important for health."
        ]
    },
    "Chapter 3: Metals and Non-metals": {
        definitions: {
            "metal": "An element that is typically hard, shiny, malleable, ductile, and conducts electricity and heat.",
            "non-metal": "An element that is brittle, dull, and a poor conductor of heat and electricity.",
            "reactivity series": "A list of metals ranked by reactivity.",
            "ionic bond": "Electrostatic force of attraction between oppositely charged ions.",
            "corrosion": "Slow conversion of metals into undesirable compounds due to environmental effects.",
            "ore": "Naturally occurring mineral from which metals can be extracted."
        },
        formulas: [],
        equations: [
            "2Mg + O‚ÇÇ ‚Üí 2MgO",
            "2Na + 2H‚ÇÇO ‚Üí 2NaOH + H‚ÇÇ‚Üë",
            "Zn + 2HCl ‚Üí ZnCl‚ÇÇ + H‚ÇÇ‚Üë",
            "Fe + O‚ÇÇ + H‚ÇÇO ‚Üí Fe‚ÇÇO‚ÇÉ¬∑xH‚ÇÇO (Rusting)"
        ],
        examples: [
            "Aluminium extraction from bauxite ore.",
            "Reaction of iron with water and air causes rusting."
        ],
        points: [
            "Metals are malleable and ductile; non-metals are not.",
            "Corrosion decreases the useful life of metals.",
            "Non-metals generally form covalent bonds."
        ]
    },
    "Chapter 4: Carbon and its Compounds": {
        definitions: {
            "covalent bond": "A chemical bond formed by the sharing of electron pairs between atoms.",
            "hydrocarbon": "Organic compound consisting entirely of hydrogen and carbon.",
            "saturated hydrocarbon": "Hydrocarbons with single bonds (alkanes).",
            "unsaturated hydrocarbon": "Hydrocarbons with double or triple bonds (alkenes, alkynes).",
            "functional group": "A group of atoms responsible for characteristic reactions of a compound.",
            "isomerism": "Phenomenon where compounds have same molecular formula but different structures.",
            "homologous series": "Family of organic compounds differing by single -CH‚ÇÇ- units."
        },
        formulas: [],
        equations: [
            "Combustion: CH‚ÇÑ + 2O‚ÇÇ ‚Üí CO‚ÇÇ + 2H‚ÇÇO",
            "Oxidation: CH‚ÇÉCH‚ÇÇOH + [O] ‚Üí CH‚ÇÉCOOH + H‚ÇÇO",
            "Addition: C‚ÇÇH‚ÇÑ + H‚ÇÇ ‚Üí C‚ÇÇH‚ÇÜ",
            "Substitution: CH‚ÇÑ + Cl‚ÇÇ ‚Üí CH‚ÇÉCl + HCl",
            "2C‚ÇÇH‚ÇÖOH + 2Na ‚Üí 2C‚ÇÇH‚ÇÖONa + H‚ÇÇ",
            "C‚ÇÇH‚ÇÖOH + CH‚ÇÉCOOH ‚Üí CH‚ÇÉCOOC‚ÇÇH‚ÇÖ + H‚ÇÇO (Esterification)",
            "CH‚ÇÉCOOH + NaOH ‚Üí CH‚ÇÉCOONa + H‚ÇÇO"
        ],
        examples: [
            "Soap formation from fats and NaOH.",
            "Esterification: Ethanol + Ethanoic acid = Ester.",
            "Unsaturated compounds decolorize bromine water."
        ],
        points: [
            "Carbon forms strong covalent bonds and long chains.",
            "Saturated hydrocarbons are less reactive than unsaturated.",
            "Functional groups determine chemical properties."
        ]
    },
    "Chapter 5: Periodic Classification of Elements": {
        definitions: {
            "periodic table": "Arrangement of elements in order of increasing atomic number.",
            "group": "A vertical column in the periodic table.",
            "period": "A horizontal row in the periodic table.",
            "valency": "Combining capacity of an atom.",
            "atomic size": "Distance from nucleus to outermost shell.",
            "metallic character": "Tendency to lose electrons.",
            "non-metallic character": "Tendency to gain electrons."
        },
        formulas: [],
        equations: [],
        examples: [
            "Lithium, sodium, and potassium form Dobereiner's triad.",
            "Newlands' law of octaves: Every eighth element has properties similar to the first."
        ],
        points: [
            "Atomic size increases down a group, decreases across a period.",
            "Valency is usually constant in a group.",
            "Modern periodic law: Properties of elements are a periodic function of atomic number."
        ]
    },
    "Chapter 6: Life Processes": {
        definitions: {
            "nutrition": "Process of obtaining and utilizing food.",
            "autotrophic nutrition": "Food synthesized from simple substances (e.g., photosynthesis).",
            "heterotrophic nutrition": "Organisms obtain food from others.",
            "respiration": "Process of breakdown of food to release energy.",
            "aerobic respiration": "Uses oxygen; complete breakdown producing CO‚ÇÇ, H‚ÇÇO, energy.",
            "anaerobic respiration": "Without oxygen; partial breakdown producing ethanol/CO‚ÇÇ/energy.",
            "transportation": "Movement of substances within an organism.",
            "excretion": "Removal of metabolic waste products.",
            "photosynthesis": "Process by which green plants make food using sunlight, water, and carbon dioxide.",
            "stomata": "Tiny pores on leaf surface for gas exchange.",
            "chlorophyll": "Green pigment in plants that captures light energy for photosynthesis.",
            "digestion": "Breaking down of complex food into simpler substances.",
            "enzyme": "Biological catalyst that speeds up chemical reactions in living organisms."
        },
        formulas: [],
        equations: [
            "Aerobic: C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ + 6O‚ÇÇ ‚Üí 6CO‚ÇÇ + 6H‚ÇÇO + energy",
            "Anaerobic: C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ ‚Üí 2C‚ÇÇH‚ÇÖOH + 2CO‚ÇÇ + energy"
        ],
        examples: [
            "Photosynthesis in plants.",
            "Human digestive system involves mouth, stomach, intestines.",
            "Nephrons are filtration units in kidney."
        ],
        points: [
            "Plants use chlorophyll for photosynthesis.",
            "Respiration releases energy required for life processes.",
            "Transportation involves heart, blood vessels, xylem, and phloem."
        ]
    },
    "Chapter 7: Control and Coordination": {
        definitions: {
            "control and coordination": "Processes that help maintain stability and responses in living beings.",
            "neuron": "Nerve cell; structural and functional unit of nervous system.",
            "reflex action": "Immediate, involuntary response to stimuli.",
            "hormone": "Chemical substance regulating activities in the body.",
            "tropism": "Directional growth response in plants."
        },
        formulas: [],
        equations: [],
        examples: [
            "Blinking of eyes is a reflex action.",
            "Adrenaline hormone increases heart rate.",
            "Phototropism: bending of plants towards light."
        ],
        points: [
            "Brain controls voluntary actions.",
            "Hormones regulate growth and metabolism.",
            "Plants coordinate with hormones and growth movements."
        ]
    },
    "Chapter 8: How do Organisms Reproduce?": {
        definitions: {
            "reproduction": "Biological process by which living organisms produce offspring.",
            "asexual reproduction": "Single organism produces offspring identical to itself.",
            "sexual reproduction": "Fusion of male and female gametes.",
            "vegetative propagation": "New plants from stems, roots, or leaves.",
            "pollination": "Transfer of pollen from anther to stigma.",
            "fertilization": "Fusion of male and female gametes."
        },
        formulas: [],
        equations: [],
        examples: [
            "Yeast undergoes budding (asexual reproduction).",
            "Sexual reproduction in humans involves sperm and egg.",
            "Potato tubers produce new plants by vegetative propagation."
        ],
        points: [
            "Asexual reproduction yields genetically identical offspring.",
            "Sexual reproduction increases genetic variation.",
            "Pollination is crucial for seed formation in plants."
        ]
    },
    "Chapter 9: Heredity and Evolution": {
        definitions: {
            "heredity": "Transmission of traits from parents to offspring.",
            "gene": "Unit of inheritance.",
            "chromosome": "Thread-like structure carrying genes.",
            "dominant trait": "Trait expressed when present.",
            "recessive trait": "Trait masked by dominant trait.",
            "evolution": "Gradual development of organisms since ancient forms.",
            "speciation": "Formation of new species."
        },
        formulas: [],
        equations: [],
        examples: [
            "Mendel's pea plant experiments.",
            "Sex determination by XX/XY chromosomes.",
            "Darwin's theory of evolution by natural selection."
        ],
        points: [
            "Genes control traits.",
            "Sex chromosomes determine gender.",
            "Fossils and homologous organs are evidence of evolution."
        ]
    },
    "Chapter 10: Light ‚Äì Reflection and Refraction": {
        definitions: {
            "reflection": "Bouncing back of light from a surface.",
            "refraction": "Bending of light as it passes from one medium to another.",
            "light": "Electromagnetic radiation that is visible to the human eye.",
            "mirror formula": "Formula relating object distance (u), image distance (v) and focal length (f): 1/f = 1/v + 1/u.",
            "magnification": "Ratio of height of image to height of object: m = h'/h = v/u.",
            "refractive index": "Ratio of speed of light in vacuum to speed in medium: n = c/v or n = sin i/sin r.",
            "lens": "Transparent material with curved surfaces that refracts light.",
            "concave mirror": "Mirror with reflecting surface curved inward.",
            "convex mirror": "Mirror with reflecting surface curved outward.",
            "focal length": "Distance between pole and focus of a mirror or lens.",
            "image": "Reproduction of an object formed by reflection or refraction of light."
        },
        formulas: [
            "Mirror/Lens: 1/f = 1/v + 1/u",
            "Magnification: m = h'/h = v/u",
            "Refractive Index: n = sin i/sin r; n = c/v"
        ],
        equations: [],
        examples: [
            "Concave mirrors form real and virtual images.",
            "Bending of pencil in water is refraction.",
            "Refraction causes objects to appear shifted."
        ],
        points: [
            "Real image is formed where rays converge; virtual where they appear to diverge.",
            "Speed of light changes in different media.",
            "Two laws of reflection: i = r and incident, reflected rays and normal lie in same plane."
        ]
    },
    "Chapter 11: The Human Eye and the Colourful World": {
        definitions: {
            "pupil": "Aperture in the center of iris; regulates light entry.",
            "retina": "Light-sensitive layer at back of eye.",
            "lens": "Transparent structure for focusing light.",
            "myopia": "Short-sightedness; can see near objects clearly.",
            "hypermetropia": "Long-sightedness; can see distant objects clearly.",
            "dispersion": "Splitting of white light into colors.",
            "atmospheric refraction": "Refraction of light by Earth's atmosphere.",
            "scattering": "Spreading of light in all directions."
        },
        formulas: [],
        equations: [],
        examples: [
            "Rainbow formation due to dispersion.",
            "Correction of myopia with concave lens."
        ],
        points: [
            "Eye adjusts focal length using ciliary muscles.",
            "Stars twinkle due to atmospheric refraction.",
            "Sky appears blue due to scattering."
        ]
    },
    "Chapter 12: Electricity": {
        definitions: {
            "electric current": "Rate of flow of electric charge: I = Q/t.",
            "potential difference": "Work done per unit charge: V = W/Q.",
            "resistance": "Opposition to current flow.",
            "electricity": "Form of energy resulting from the flow of electric charge.",
            "current": "Rate of flow of electric charge measured in amperes.",
            "voltage": "Electric potential difference between two points.",
            "ohm's law": "V = IR; voltage is proportional to current.",
            "power": "Rate of doing work: P = VI.",
            "energy": "Total work done: E = P √ó t.",
            "series combination": "Resistors joined end-to-end; Rtotal = R1+R2+...",
            "parallel combination": "Resistors connected side by side; 1/Rtotal = 1/R1 + 1/R2 + ...",
            "conductor": "Material that allows electric current to flow easily.",
            "insulator": "Material that does not allow electric current to flow easily.",
            "circuit": "Closed path through which electric current flows.",
            "ammeter": "Device used to measure electric current in a circuit.",
            "voltmeter": "Device used to measure potential difference across a component."
        },
        formulas: [
            "Ohm's Law: V = IR",
            "Power: P = VI; P = I¬≤R; P = V¬≤/R",
            "Energy: E = P √ó t (kWh)",
            "Rseries = R1 + R2 + ...",
            "1/Rparallel = 1/R1 + 1/R2 + ..."
        ],
        equations: [],
        examples: [
            "A 10V battery and 5Œ© resistor: I = V/R = 10/5 = 2A.",
            "Electric bulb converts electrical energy into light and heat."
        ],
        points: [
            "SI unit of current is ampere (A).",
            "High resistance reduces current.",
            "Electric energy is measured in kilowatt hour (kWh)."
        ]
    },
    "Chapter 13: Magnetic Effects of Electric Current": {
        definitions: {
            "magnetic field": "Region around a magnet where force is felt.",
            "electromagnet": "Temporary magnet by current in coil.",
            "electromagnetic induction": "Production of current by changing magnetic field.",
            "fleming's left hand rule": "Gives direction of force, current, magnetic field.",
            "right-hand thumb rule": "Direction of magnetic field around current wire."
        },
        formulas: [
            "Force: F = BIL"
        ],
        equations: [],
        examples: [
            "Electric fan uses a motor (electromagnet).",
            "Induced current in generator (electromagnetic induction)."
        ],
        points: [
            "Magnetic field lines form closed loops.",
            "Current-carrying wire produces magnetic field.",
            "Thumb rule gives direction of field."
        ]
    },
    "Chapter 14: Sources of Energy": {
        definitions: {
            "renewable energy": "Energy from sources that can be replenished.",
            "non-renewable energy": "Energy from sources that are finite.",
            "solar energy": "Energy from sun.",
            "geothermal energy": "Energy from Earth's internal heat.",
            "tidal energy": "Energy from tides in seas."
        },
        formulas: [],
        equations: [],
        examples: [
            "Solar panels convert sunlight to electricity.",
            "Wind turbines generate electric power."
        ],
        points: [
            "Renewable sources have less environmental impact.",
            "Fossil fuels cause pollution.",
            "Biogas is a clean energy source."
        ]
    },
    "Chapter 15: Our Environment": {
        definitions: {
            "ecosystem": "Interaction of living and non-living things in an area.",
            "food chain": "Sequence showing feeding relationship.",
            "food web": "Interconnected food chains.",
            "trophic level": "Position in food chain.",
            "biodegradable": "Can be decomposed by microorganisms.",
            "non-biodegradable": "Cannot be decomposed easily."
        },
        formulas: [],
        equations: [],
        examples: [
            "Grass ‚Üí Grasshopper ‚Üí Frog ‚Üí Snake ‚Üí Eagle.",
            "Plastic: non-biodegradable waste."
        ],
        points: [
            "Ozone layer protects Earth from UV rays.",
            "Energy flow in ecosystem is unidirectional.",
            "Waste management prevents pollution."
        ]
    },
    "Chapter 16: Management of Natural Resources": {
        definitions: {
            "resource": "Anything that can be used for benefit.",
            "conservation": "Wise use and protection of resources.",
            "sustainable development": "Development meeting present needs without harming future.",
            "water harvesting": "Collection of rainwater for use.",
            "reduce, reuse, recycle": "Methods to minimize resource waste."
        },
        formulas: [],
        equations: [],
        examples: [
            "Rainwater harvesting in houses.",
            "Recycling paper saves trees."
        ],
        points: [
            "Resource conservation is essential for future.",
            "Forests maintain ecological balance.",
            "Everyone should practice 3Rs: Reduce, Reuse, Recycle."
        ]
    }
};

// Global array of exam-style random questions
const globalQuestions = [
    "Define chemical reaction.",
    "Explain the law of conservation of mass with example.",
    "List types of chemical reactions and give one example for each.",
    "Write the equation for rusting of iron.",
    "What is a redox reaction? Give example.",
    "What is a balanced chemical equation?",
    "Differentiate between displacement and double displacement reaction.",
    "State two observations you may notice during a chemical reaction.",
    "How is rancidity prevented?",
    "Give an example of a combination reaction.",
    "What is the pH scale? How is it used?",
    "Write the reaction for the preparation of baking soda.",
    "Explain neutralization with a chemical equation.",
    "Name two indicators and their colour changes.",
    "Why is common salt important in daily life?",
    "Define acid and base.",
    "What is the reactivity series of metals?",
    "Write the equation for the reaction of sodium with water.",
    "What is corrosion? How can it be prevented?",
    "Differentiate between metal and non-metal.",
    "Define isomerism with an example.",
    "Give the reaction for the combustion of methane.",
    "Explain the term homologous series.",
    "What is soap? How is it formed?",
    "What is modern periodic law?",
    "Explain trends in atomic size in the periodic table.",
    "Define group and period in periodic table.",
    "What is metallic character?",
    "Write the equation for aerobic respiration.",
    "Explain autotrophic and heterotrophic nutrition.",
    "What is the function of nephron in kidney?",
    "What is a neuron?",
    "Explain reflex action with example.",
    "What is the role of hormone adrenaline?",
    "Define sexual reproduction.",
    "Explain vegetative propagation with examples.",
    "What is pollination?",
    "Define heredity.",
    "What is speciation?",
    "Explain Mendel's law of segregation.",
    "State laws of reflection.",
    "Define refraction with example.",
    "Write mirror formula.",
    "Explain magnification with formula.",
    "What is refractive index?",
    "What is myopia and how is it corrected?",
    "Define dispersion of light.",
    "Why do stars twinkle?",
    "State Ohm's law.",
    "Define potential difference.",
    "Write formula for resistance in parallel.",
    "What is kilowatt hour?",
    "Explain electromagnetic induction.",
    "State Fleming's left hand rule.",
    "What is an electromagnet?",
    "Define renewable energy source.",
    "Give two examples of non-renewable sources.",
    "Explain food chain with example.",
    "List three methods of waste management.",
    "What is water harvesting?",
    "Explain the 3Rs with example."
];

// MCQ Database
const mcqDatabase = [
    {q: "Which of the following is an example of a decomposition reaction?", options: ["CaCO‚ÇÉ ‚Üí CaO + CO‚ÇÇ", "2Mg + O‚ÇÇ ‚Üí 2MgO", "Zn + CuSO‚ÇÑ ‚Üí ZnSO‚ÇÑ + Cu", "NaOH + HCl ‚Üí NaCl + H‚ÇÇO"], correct: 0},
    {q: "The pH of lemon juice is approximately:", options: ["2", "7", "10", "14"], correct: 0},
    {q: "Which metal is most reactive?", options: ["Gold", "Silver", "Potassium", "Copper"], correct: 2},
    {q: "Ethanol is converted to ethanoic acid by:", options: ["Addition", "Substitution", "Oxidation", "Reduction"], correct: 2},
    {q: "The SI unit of electric current is:", options: ["Volt", "Ampere", "Ohm", "Watt"], correct: 1},
    {q: "Mitochondria is known as:", options: ["Powerhouse of cell", "Suicide bag", "Control center", "Protein factory"], correct: 0},
    {q: "The focal length of a convex lens is:", options: ["Negative", "Positive", "Zero", "Infinite"], correct: 1},
    {q: "Myopia can be corrected using:", options: ["Convex lens", "Concave lens", "Bifocal lens", "Cylindrical lens"], correct: 1},
    {q: "Biogas mainly contains:", options: ["Oxygen", "Nitrogen", "Methane", "Carbon monoxide"], correct: 2},
    {q: "Ozone layer protects us from:", options: ["Infrared rays", "UV rays", "X-rays", "Gamma rays"], correct: 1},
    {q: "In series combination of resistors, total resistance:", options: ["Decreases", "Remains same", "Increases", "Becomes zero"], correct: 2},
    {q: "Chromosomes are made of:", options: ["DNA and proteins", "RNA only", "Lipids", "Carbohydrates"], correct: 0},
    {q: "Photosynthesis occurs in:", options: ["Mitochondria", "Chloroplast", "Nucleus", "Ribosome"], correct: 1},
    {q: "The chemical formula of washing soda is:", options: ["NaHCO‚ÇÉ", "Na‚ÇÇCO‚ÇÉ¬∑10H‚ÇÇO", "NaCl", "CaOCl‚ÇÇ"], correct: 1},
    {q: "Twinkling of stars is due to:", options: ["Reflection", "Refraction", "Dispersion", "Scattering"], correct: 1}
];

let currentMCQIndex = 0;
let mcqScore = 0;
let mcqTotal = 0;
let inMCQMode = false;
let lastTopic = null;
let lastChapter = null;

const manualText = `<span style="color:#667eea;font-weight:600;">üìö NCERT Science Bot ‚Äì Command Manual</span>
<ul style="line-height:1.9;">
<li><b>question</b> - Get 10 random exam-style questions from entire syllabus</li>
<li><b>test</b> - Start full test mode with 10 MCQs + 10 written questions with scoring</li>
<li><b>mcq</b> - Practice single MCQ questions one by one</li>
<li><b>[any topic keyword]</b> - Type any topic like "decomposition", "electricity", "photosynthesis" and I'll find the best match!</li>
<li><b>formula of [chapter/topic]</b> - Get all formulas from that chapter with examples</li>
<li><b>types of [topic]</b> - Shows all types with definitions</li>
<li><b>definition [topic]</b> - Get specific definition only</li>
<li><b>all definitions of [chapter]</b> - All definitions from a chapter</li>
<li><b>summary [chapter/topic]</b> - Quick summary bullet points</li>
<li><b>example [topic]</b> - Get solved examples for the topic</li>
<li><b>manual</b> or <b>help</b> - Show this command list</li>
</ul>
<div class="info-box" style="margin-top:12px;">
<b>üí° Pro Tip:</b> Just type keywords! For example: "decomposition", "baking soda", "electricity formula", "test photosynthesis" - I'm smart enough to understand! üòé
</div>`;

function getRandomQuestions() {
    let arr = [];
    let j = 0;
    let used = {};
    while (arr.length < 10 && j < globalQuestions.length * 3) {
        let r = Math.floor(Math.random() * globalQuestions.length);
        if (!used[r]) {
            arr.push(globalQuestions[r]);
            used[r] = 1;
        }
        j++;
    }
    return arr;
}

function getRandomMCQs(count) {
    let arr = [];
    let used = {};
    let attempts = 0;
    while (arr.length < count && attempts < mcqDatabase.length * 3) {
        let r = Math.floor(Math.random() * mcqDatabase.length);
        if (!used[r]) {
            arr.push(mcqDatabase[r]);
            used[r] = 1;
        }
        attempts++;
    }
    return arr;
}

// Utility functions
function objectFind(obj, key) {
    key = key.toLowerCase().trim();
    const found = Object.keys(obj).filter(k =>
        k.replace(/[^\w\d]/g,'').toLowerCase().includes(key.replace(/[^\w\d]/g,'').toLowerCase())
    );
    return found.length ? {key: found[0], value: obj[found[0]]} : null;
}

function chapterFind(chapInput) {
    chapInput = chapInput.toLowerCase().replace(/\s+/g, "");
    for(const c in data) {
        if(c.replace(/\s+/g,"").toLowerCase().includes(chapInput))
            return c;
    }
    return null;
}

function findBestTopicMatch(query) {
    query = query.toLowerCase().trim();
    let bestMatch = null;
    let bestChapter = null;
    let highestScore = 0;
    
    // Remove common words that shouldn't trigger matches
    const commonWords = ['hi', 'hello', 'hey', 'what', 'is', 'the', 'a', 'an', 'how', 'why', 'when', 'where', 'are', 'i', 'you', 'can', 'please', 'tell', 'me', 'about'];
    const queryWords = query.split(/\s+/).filter(w => !commonWords.includes(w) && w.length > 2);
    
    // If only common words, return null
    if(queryWords.length === 0) {
        return null;
    }
    
    // Rebuild query without common words
    const cleanQuery = queryWords.join(' ');

    for(const chap in data) {
        for(const key in data[chap].definitions) {
            const keyLower = key.toLowerCase();
            const similarity = calculateSimilarity(cleanQuery, keyLower);
            if(similarity > highestScore) {
                highestScore = similarity;
                bestMatch = key;
                bestChapter = chap;
            }
        }
    }
    
    // Lower threshold since we cleaned the query
    return highestScore > 0.5 ? {match: bestMatch, chapter: bestChapter, score: highestScore} : null;
}

function calculateSimilarity(str1, str2) {
    const words1 = str1.replace(/[^\w\d]/g, ' ').toLowerCase().split(/\s+/).filter(w => w.length > 2);
    const words2 = str2.replace(/[^\w\d]/g, ' ').toLowerCase().split(/\s+/).filter(w => w.length > 2);
    
    if(words1.length === 0 || words2.length === 0) return 0;
    
    // Check for exact substring match first
    if(str2.includes(str1) || str1.includes(str2)) {
        return 1.0;
    }
    
    let matches = 0;
    let totalWords = 0;
    
    for(const w1 of words1) {
        totalWords++;
        let bestWordMatch = 0;
        for(const w2 of words2) {
            if(w1 === w2) {
                bestWordMatch = 1.0;
                break;
            } else if(w1.length > 4 && w2.length > 4) {
                if(w1.includes(w2) || w2.includes(w1)) {
                    bestWordMatch = Math.max(bestWordMatch, 0.8);
                }
            }
        }
        matches += bestWordMatch;
    }
    
    return totalWords > 0 ? matches / totalWords : 0;
}

const humorousResponses = [
    "Wow, that was faster than my internet connection! üòÖ Next question coming up...",
    "Alright speed demon, let's see if you can handle the next one! üöÄ",
    "Someone's on fire today! üî• But can you keep up?",
    "Impressive! Or did you just get lucky? ü§î Let's find out...",
    "Okay Einstein, calm down! üòé Here's the next one...",
    "You're making this look too easy! Time to turn up the heat! üå∂Ô∏è"
];

// Main chatbot processing
async function processInput(msg) {
    const msgRaw = msg.trim();
    const msgL = msgRaw.toLowerCase();
    let reply = "";

    if (!msgRaw) return;

    // MCQ Mode handling
    if (inMCQMode) {
        if (msgL === "right" || msgL === "next" || msgL === "skip") {
            currentMCQIndex++;
            if (currentMCQIndex >= mcqDatabase.length) {
                currentMCQIndex = 0;
            }
            const humor = humorousResponses[Math.floor(Math.random() * humorousResponses.length)];
            reply = `<div class="glow-text">${humor}</div><br>`;
            reply += displayMCQ(mcqDatabase[currentMCQIndex], currentMCQIndex);
            appendBotMsg(reply);
            return;
        } else if (msgL === "exit" || msgL === "stop") {
            inMCQMode = false;
            reply = "MCQ practice mode ended! üìö Type 'mcq' anytime to practice again.";
            appendBotMsg(reply);
            return;
        }
    }

    // Command: manual/help
    if (msgL === "manual" || msgL === "help" || msgL === "/help") {
        reply = manualText;
        appendBotMsg(reply);
        return;
    }

    // Command: test mode
    if (msgL.includes("test")) {
        let mcqs = getRandomMCQs(10);
        let questions = getRandomQuestions();
        
        reply = `<div class="glow-text" style="font-size:1.2em;margin-bottom:15px;">üéØ TEST MODE ACTIVATED! üéØ</div>`;
        reply += `<div class="score-display"><b>Part A: Multiple Choice Questions (10 √ó 1 = 10 marks)</b></div>`;
        
        mcqs.forEach((mcq, i) => {
            reply += `<div style="margin:15px 0;"><b>Q${i+1}.</b> ${mcq.q}<br>`;
            mcq.options.forEach((opt, j) => {
                reply += `<div class="mcq-option">${String.fromCharCode(65+j)}) ${opt}</div>`;
            });
            reply += `</div>`;
        });
        
        reply += `<div class="score-display" style="margin-top:20px;"><b>Part B: Written Questions (10 √ó 2 = 20 marks)</b></div><ol>`;
        questions.forEach(q => {
            reply += `<li style="margin:10px 0;">${q}</li>`;
        });
        reply += `</ol>`;
        reply += `<div style="margin-top:20px;padding:12px;background:rgba(255,22,84,0.1);border-radius:6px;"><b>üìù Total: 30 Marks | Time: 45 minutes</b><br>All the best! üí™</div>`;
        
        appendBotMsg(reply);
        return;
    }

    // Command: MCQ practice mode
    if (msgL === "mcq") {
        inMCQMode = true;
        currentMCQIndex = Math.floor(Math.random() * mcqDatabase.length);
        reply = `<div class="glow-text">üéÆ MCQ Practice Mode Activated!</div><br>`;
        reply += `Type <b>'right'</b>, <b>'next'</b>, or <b>'skip'</b> to move to the next question.<br>`;
        reply += `Type <b>'exit'</b> to stop practicing.<br><br>`;
        reply += displayMCQ(mcqDatabase[currentMCQIndex], currentMCQIndex);
        appendBotMsg(reply);
        return;
    }

    // Command: Get random questions
    if (msgL === "question" || msgL === "questions") {
        let qArr = getRandomQuestions();
        reply = `<div class="glow-text" style="font-weight:600;font-size:1.1em;">üìù 10 Random Exam Questions:</div><ol>`;
        for(const q of qArr) reply += `<li style="margin:8px 0;">${q}</li>`;
        reply += "</ol>";
        appendBotMsg(reply);
        return;
    }

    // Command: All definitions of chapter
    if (msgL.startsWith("all definitions of")) {
        let chapterName = msgRaw.substr(18).trim();
        let chap = chapterFind(chapterName);
        if(!chap) {
            reply = "ü§î Hmm, I couldn't find that chapter. Try something like 'all definitions of electricity' or 'all definitions of acids bases salts'.";
        } else {
            let defs = data[chap]?.definitions;
            if(!defs) reply = "No definitions found for " + chap + ".";
            else {
                reply = `<div class="glow-text" style="font-size:1.15em;margin-bottom:12px;">üìö All Definitions from <b>${chap}</b>:</div><ul style="line-height:1.8;">`;
                for(const k in defs) reply += `<li><b>${k}:</b> ${defs[k]}</li>`;
                reply += "</ul>";
            }
        }
        appendBotMsg(reply);
        return;
    }

    // Command: Definition [topic]
    if (msgL.startsWith("definition") || msgL.startsWith("what is") || msgL.startsWith("what are") || msgL.startsWith("define")) {
        let key = msgRaw.replace(/^(definition|what is|what are|define)\s*/i, '').trim();
        let foundDef = null;
        let foundKey = null;
        let foundChap = null;
        
        for(const chap in data) {
            let result = objectFind(data[chap].definitions || {}, key);
            if(result) {
                foundDef = result.value;
                foundKey = result.key;
                foundChap = chap;
                break;
            }
        }
        
        if(!foundDef) {
            let bestMatch = findBestTopicMatch(key);
            if(bestMatch) {
                reply = `<div class="glow-text">ü§î Did you mean <b>"${bestMatch.match}"</b>?</div><br>`;
                reply += `<div class="success-box"><b>üìñ Definition:</b> ${data[bestMatch.chapter].definitions[bestMatch.match]}</div>`;
                reply += `<div class="info-box" style="font-size:0.92em;"><b>üìö From Chapter:</b> ${bestMatch.chapter}</div>`;
                lastTopic = bestMatch.match;
                lastChapter = bestMatch.chapter;
            } else {
                reply = "üòï Hmm, I couldn't find that definition. Try using keywords like 'acid', 'photosynthesis', 'reflection', 'current', etc. Or just type the topic directly!";
            }
        } else {
            reply = `<div class="glow-text"><b>üìñ Definition of "${foundKey}":</b></div><br>`;
            reply += `<div class="success-box">${foundDef}</div>`;
            reply += `<div class="info-box" style="font-size:0.92em;"><b>üìö From Chapter:</b> ${foundChap}</div>`;
            lastTopic = foundKey;
            lastChapter = foundChap;
        }
        
        appendBotMsg(reply);
        return;
    }

    // Command: Formula of [chapter/topic] OR just "formula" (use context)
    if (msgL.startsWith("formula of") || msgL.startsWith("formulas of") || msgL === "formula" || msgL === "formulas") {
        let key = msgL === "formula" || msgL === "formulas" ? "" : msgRaw.replace(/^formulas? of /i, '').trim();
        
        // If just "formula" and we have context, use last topic
        if(!key && lastChapter) {
            key = lastChapter;
            reply = `<div class="glow-text">üìù Here are the formulas related to <b>"${lastTopic}"</b>:</div><br>`;
        } else if(!key) {
            reply = "Please specify what formulas you need! For example: 'formula of electricity' or ask about a topic first, then type 'formula'.";
            appendBotMsg(reply);
            return;
        }
        
        let chap = chapterFind(key);
        
        if(chap) {
            let forms = data[chap].formulas || [];
            let eqs = data[chap].equations || [];
            let exs = data[chap].examples || [];
            
            if(forms.length === 0 && eqs.length === 0) {
                reply = `üìù No specific formulas found in ${chap}, but here are the key points and examples:<br><br>`;
                if(data[chap].points) {
                    reply += "<b>Key Points:</b><ul>";
                    data[chap].points.forEach(p => reply += `<li>${p}</li>`);
                    reply += "</ul>";
                }
            } else {
                if(!reply) reply = `<div class="glow-text" style="font-size:1.15em;margin-bottom:12px;">üßÆ Formulas from <b>${chap}</b>:</div>`;
                
                if(forms.length) {
                    reply += "<div style='margin:10px 0;'><b>Formulas:</b><ul>";
                    forms.forEach(f => reply += `<li>${f}</li>`);
                    reply += "</ul></div>";
                }
                
                if(eqs.length) {
                    reply += "<div style='margin:10px 0;'><b>Important Equations:</b><ul>";
                    eqs.forEach(e => reply += `<li>${e}</li>`);
                    reply += "</ul></div>";
                }
                
                if(exs.length) {
                    reply += "<div style='margin:10px 0;'><b>Examples:</b><ul>";
                    exs.forEach(ex => reply += `<li>${ex}</li>`);
                    reply += "</ul></div>";
                }
            }
        } else {
            reply = "ü§î I couldn't find that chapter. Try 'formula of electricity' or 'formula of light reflection'.";
        }
        
        appendBotMsg(reply);
        return;
    }

    // Command: Types of [topic]
    if (/^types of/.test(msgL)) {
        let key = msgRaw.replace(/^types of /i, '').trim();
        let found = null;
        
        for(const chap in data) {
            if(data[chap].typesOfReaction) {
                found = data[chap].typesOfReaction;
                break;
            }
        }
        
        if(found) {
            reply = `<div class="glow-text" style="font-size:1.15em;margin-bottom:12px;">‚öóÔ∏è Types of ${key}:</div>`;
            found.forEach(obj => {
                reply += `<div style="margin:12px 0;padding:10px;background:rgba(46,204,113,0.05);border-left:3px solid #2ecc71;border-radius:4px;">`;
                reply += `<b>${obj.type}:</b> ${obj.def}</div>`;
            });
        } else {
            reply = "No types found for that topic. Try 'types of reaction' or 'types of chemical reactions'.";
        }
        
        appendBotMsg(reply);
        return;
    }

    // Command: Summary [chapter/topic]
    if (msgL.startsWith("summary")) {
        let key = msgRaw.substr(7).trim();
        let found = null;
        let chapName = null;
        
        for(const chap in data) {
            if(chap.toLowerCase().includes(key.toLowerCase())) {
                found = data[chap].points || [];
                chapName = chap;
                break;
            }
        }
        
        if(!found || found.length === 0) {
            reply = "üòï No summary found. Try 'summary electricity' or 'summary life processes'.";
        } else {
            reply = `<div class="glow-text" style="font-size:1.15em;margin-bottom:12px;">üìã Summary of ${chapName}:</div><ul style="line-height:1.8;">`;
            for(const pt of found) reply += `<li>${pt}</li>`;
            reply += "</ul>";
        }
        
        appendBotMsg(reply);
        return;
    }

    // Command: Example [topic] OR just "example" (use context)
    if(msgL.startsWith("example") || msgL === "example" || msgL === "examples") {
        let key = msgL === "example" || msgL === "examples" ? "" : msgRaw.substr(7).trim();
        
        // If just "example" and we have context, use last topic
        if(!key && lastTopic) {
            key = lastTopic;
        } else if(!key) {
            reply = "Please specify what examples you need! For example: 'example decomposition' or ask about a topic first, then type 'example'.";
            appendBotMsg(reply);
            return;
        }
        
        let found = [];
        
        for(const chap in data) {
            for(const ex of (data[chap].examples||[])) {
                if(ex.toLowerCase().includes(key.toLowerCase()))
                    found.push(ex);
            }
        }
        
        if(!found.length) reply = "üîç No specific examples found for that topic. Try being more specific!";
        else {
            reply = `<div class="glow-text"><b>üí° Examples for '${key}':</b></div><ul style="line-height:1.8;">`;
            for(const ex of found) reply += `<li>${ex}</li>`;
            reply += "</ul>";
        }
        
        appendBotMsg(reply);
        return;
    }
    
    // General topic search (smart matching)
    
    // Handle greetings and casual messages
    const greetings = ['hi', 'hello', 'hey', 'sup', 'yo', 'greetings', 'good morning', 'good evening', 'good afternoon'];
    if(greetings.some(g => msgL === g || msgL.startsWith(g + ' '))) {
        const greetResponses = [
            "Hey there! üëã Ready to master some science? Try asking me about any topic like 'what is electricity' or 'photosynthesis'!",
            "Hello! üî¨ I'm your science tutor. Ask me anything - 'what is photosynthesis?', 'explain electricity', or just type 'decomposition'!",
            "Hi! üòä Type any science question like 'what is electricity' or just topics like 'photosynthesis', 'acids', 'light'!",
            "Greetings, future scientist! üß™ Ask me about any Class 10 Science topic! Try 'what is respiration' or 'electricity'."
        ];
        reply = greetResponses[Math.floor(Math.random() * greetResponses.length)];
        appendBotMsg(reply);
        return;
    }
    
    // Check for conversational patterns
    if(msgL.includes('thank') || msgL.includes('thanks')) {
        reply = "You're welcome! üòä Keep learning and feel free to ask more questions anytime!";
        appendBotMsg(reply);
        return;
    }
    
    if(msgL.includes('who are you') || msgL.includes('what are you')) {
        reply = "I'm your NCERT Class 10 Science AI Tutor! ü§ñ I can help you with definitions, formulas, examples, and practice tests. Ask me about any science topic!";
        appendBotMsg(reply);
        return;
    }
    
    let bestMatch = findBestTopicMatch(msgRaw);
    
    if(bestMatch) {
        let chap = bestMatch.chapter;
        let topic = bestMatch.match;
        
        // Store context
        lastTopic = topic;
        lastChapter = chap;
        
        reply = `<div class="glow-text">üí° Oh, you mean <b>"${topic}"</b>! Here's everything about it:</div><br>`;
        
        // Definition
        if(data[chap].definitions[topic]) {
            reply += `<div class="success-box">`;
            reply += `<b>üìñ Definition:</b> ${data[chap].definitions[topic]}</div>`;
        }
        
        // Related formulas
        let relatedFormulas = [];
        if(data[chap].formulas) {
            relatedFormulas = data[chap].formulas.filter(f => 
                f.toLowerCase().includes(topic.toLowerCase())
            );
        }
        if(relatedFormulas.length) {
            reply += `<div style="margin:14px 0;"><b>üßÆ Related Formulas:</b><ul>`;
            relatedFormulas.forEach(f => reply += `<li>${f}</li>`);
            reply += `</ul></div>`;
        }
        
        // Examples
        let relatedExamples = [];
        if(data[chap].examples) {
            relatedExamples = data[chap].examples.filter(ex => 
                ex.toLowerCase().includes(topic.toLowerCase())
            );
        }
        if(relatedExamples.length) {
            reply += `<div style="margin:14px 0;"><b>üí° Examples:</b><ul>`;
            relatedExamples.forEach(ex => reply += `<li>${ex}</li>`);
            reply += `</ul></div>`;
        }
        
        // Key points
        let relatedPoints = [];
        if(data[chap].points) {
            relatedPoints = data[chap].points.filter(p => 
                p.toLowerCase().includes(topic.toLowerCase())
            );
        }
        if(relatedPoints.length) {
            reply += `<div style="margin:14px 0;"><b>üéØ Key Points:</b><ul>`;
            relatedPoints.forEach(p => reply += `<li>${p}</li>`);
            reply += `</ul></div>`;
        }
        
        reply += `<div class="info-box" style="font-size:0.92em;">`;
        reply += `<b>üìö From Chapter:</b> ${chap}<br>`;
        reply += `<i>üí¨ You can now ask 'formula', 'example', or 'summary' for more info!</i></div>`;
        
    } else {
        // Reset context if no match
        lastTopic = null;
        lastChapter = null;
        
        reply = "ü§î Hmm, I couldn't quite understand that. Try:<br>";
        reply += "‚Ä¢ Typing a clear keyword like 'decomposition', 'electricity', 'photosynthesis'<br>";
        reply += "‚Ä¢ Using commands like 'formula of electricity' or 'types of reaction'<br>";
        reply += "‚Ä¢ Type <b>'manual'</b> to see all available commands!<br>";
        reply += "‚Ä¢ Or try <b>'test'</b> for a full practice test! üìù";
    }
    
    appendBotMsg(reply);
}

function displayMCQ(mcq, index) {
    let html = `<div style="padding:15px;background:rgba(46,204,113,0.08);border-radius:8px;border-left:4px solid #2ecc71;">`;
    html += `<b>Question ${index + 1}:</b> ${mcq.q}<br><br>`;
    mcq.options.forEach((opt, i) => {
        html += `<div class="mcq-option">${String.fromCharCode(65+i)}) ${opt}</div>`;
    });
    html += `</div>`;
    return html;
}

// Chat output functions
function appendUserMsg(msg) {
    let chatWindow = document.getElementById('chat-window');
    chatWindow.innerHTML += `<div class="user-msg">üë§ ${msg}</div>`;
    chatWindow.scrollTop = chatWindow.scrollHeight;
}

function appendBotMsg(msg) {
    let chatWindow = document.getElementById('chat-window');
    let botDiv = document.createElement('div');
    botDiv.className = 'bot-msg typing';
    chatWindow.appendChild(botDiv);
    
    let i = 0;
    function typingStep() {
        if (i <= msg.length) {
            botDiv.innerHTML = msg.slice(0, i) + "<span style='border-right:2px solid #2ecc71;'> </span>";
            chatWindow.scrollTop = chatWindow.scrollHeight;
            i++;
            setTimeout(typingStep, 8 + Math.floor(Math.random()*12));
        } else {
            botDiv.innerHTML = msg;
            botDiv.className = 'bot-msg';
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
    }
    typingStep();
}

// Event listeners
document.getElementById('send-btn').onclick = function(){
    let val = document.getElementById('user-input').value.trim();
    if(!val) return;
    appendUserMsg(val);
    processInput(val);
    document.getElementById('user-input').value = "";
};

document.getElementById('entry-bar').onsubmit = function(){
    document.getElementById('send-btn').click();
    return false;
};

document.getElementById('user-input').addEventListener('keydown', function(e){
    if(e.key === "Enter"){
        document.getElementById('send-btn').click();
    }
});

// Initial greeting
appendBotMsg(`<div class="glow-text" style="font-size:1.2em;margin-bottom:10px;">üéì Welcome to NCERT Class 10 Science Bot!</div>
<div style="line-height:1.8;">
I'm your friendly AI tutor with a sense of humor! üòÑ<br><br>
‚ú® <b>Quick Start:</b><br>
‚Ä¢ Type any topic: "decomposition", "electricity", "photosynthesis"<br>
‚Ä¢ Get formulas: "formula of electricity"<br>
‚Ä¢ Practice: Type <b>"mcq"</b> for single questions or <b>"test"</b> for full exam!<br>
‚Ä¢ Need help? Type <b>"manual"</b><br><br>
Let's ace that Science exam! üí™üî¨
</div>`);
    </script>
</body>
</html>
